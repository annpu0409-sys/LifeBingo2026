<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <title>2026 äººç”Ÿç›®æ¨™è³“æœ</title>
    <style>
        :root {
            --primary-color: #f39c12;
            --bg-color: #f9f9f9;
            --cell-size: 70px;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-image: url('https://i.pinimg.com/1200x/c4/6d/29/c46d29dea9b69e871e3cace9003b2e71.jpg');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        h1 { color: #333; margin-bottom: 10px; }
        .description { font-size: 0.9rem; color: #666; margin-bottom: 20px; text-align: center; background: rgba(255,255,255,0.7); padding: 5px 10px; border-radius: 20px; }

        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 500px;
            width: 100%;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .cell {
            aspect-ratio: 1 / 1;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            text-align: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .cell:hover { border-color: var(--primary-color); background: #fffef0; }

        .cell.completed {
            background-color: #ffeaa7;
            border-color: var(--primary-color);
            color: #d35400;
            font-weight: bold;
            animation: pop 0.3s ease-out;
        }

        .cell.completed::after {
            content: "âœ“";
            position: absolute;
            font-size: 2rem;
            color: rgba(243, 156, 18, 0.3);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .type-core { border-style: double; border-width: 4px; }
        .type-main { background-color: #f0f7ff; }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; color: #444; }
        
        .grid-inputs, .grid-inputs-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .goal-input { 
            width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 0.85rem;
        }
        .goal-input:focus { border-color: var(--primary-color); outline: none; background: #fffdf0; }
        
        .clear-btn-container { width: 100%; display: flex; justify-content: center; margin: 10px 0 20px 0; }
        button[onclick="clearAllGoals()"] {
            background-color: #c0392b; color: #fff; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s;
        }

        footer { text-align: center; padding: 20px; font-size: 14px; color: #888; }
        footer a { color: #f39c12; text-decoration: none; }
    </style>
</head>
<body>

    <h1>2026 äººç”Ÿç›®æ¨™è³“æœ</h1>
  
    <div id="setup-wizard" style="max-width: 500px; width: 100%; background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
        <h3>Step 1: å¡«å¯«ä½ çš„ 2026 ç›®æ¨™</h3>
        <!-- <p style="font-size: 0.8rem; color: #999;">è¨»ï¼šé€±æœ«ä»»å‹™èˆ‡é¡˜æœ›ä½å°‡åœ¨å³å´è³“æœç›¤éš¨æ©Ÿæ“ºæ”¾ä½ç½®</p> -->
        
        <div class="input-group">
            <label>ğŸŒŸ æ ¸å¿ƒï¼šä»Šå¹´çµ•å°èƒ½é”æˆçš„ä¸€ä»¶äº‹</label>
            <input type="text" class="goal-input" data-index="12" placeholder="ä¾‹å¦‚ï¼šæ¯å¤©å–æ°´ 2000cc">
        </div>

        <div class="input-group">
            <label>ğŸ¯ æ ¸å¿ƒç›®æ¨™ï¼šæ¯”è¼ƒèªçœŸçš„æŒ‘æˆ°</label>
            <div class="grid-inputs">
                <input type="text" class="goal-input" data-index="6" placeholder="ç›®æ¨™ 1">
                <input type="text" class="goal-input" data-index="8" placeholder="ç›®æ¨™ 2">
                <input type="text" class="goal-input" data-index="16" placeholder="ç›®æ¨™ 3">
                <input type="text" class="goal-input" data-index="18" placeholder="ç›®æ¨™ 4">
            </div>
        </div>

        <div class="input-group">
            <label>ğŸ“… å¹´åº¦äº‹ä»¶ï¼šèˆ‡ç‰¹å®šæ™‚ç¯€ç›¸é—œ</label>
            <div class="grid-inputs">
                <input type="text" class="goal-input" data-index="7" placeholder="ä¾‹å¦‚ï¼šçœ‹å¤å­£ç…™ç«">
                <input type="text" class="goal-input" data-index="11" placeholder="ä¾‹å¦‚ï¼šè³æ«»èŠ±">
                <input type="text" class="goal-input" data-index="13" placeholder="ä¾‹å¦‚ï¼šè·¨å¹´æ—…è¡Œ">
                <input type="text" class="goal-input" data-index="17" placeholder="ä¾‹å¦‚ï¼šé€±å¹´ç´€å¿µ">
            </div>
        </div>

        <div class="input-group">
            <label>ğŸš¶ é€±æœ«ä»»å‹™ï¼šå…©å¤©å…§å¯æå®š</label>
            <div class="grid-inputs-4">
                <input type="text" class="goal-input" data-index="0" placeholder="æ•´ç†æˆ¿é–“">
                <input type="text" class="goal-input" data-index="2" placeholder="è®€å®Œä¸€æœ¬æ›¸">
                <input type="text" class="goal-input" data-index="4" placeholder="è²·æ–°å®¶é›»">
                <input type="text" class="goal-input" data-index="10" placeholder="çœ‹å ´é›»å½±">
                <input type="text" class="goal-input" data-index="14" placeholder="æ›æ–°é«®å‹">
                <input type="text" class="goal-input" data-index="20" placeholder="åƒæ–°é¤å»³">
                <input type="text" class="goal-input" data-index="22" placeholder="æ–·æ¨é›¢">
                <input type="text" class="goal-input" data-index="24" placeholder="é€›åšç‰©é¤¨">
            </div>
        </div>

        <div class="input-group">
            <label>ğŸ€ é¡˜æœ›ä½ï¼šåå‘é‹æ°£æˆ–å¤§é¡˜æœ›</label>
            <div class="grid-inputs-4">
                <input type="text" class="goal-input" data-index="1" placeholder="ç™¼ç¥¨ä¸­ç">
                <input type="text" class="goal-input" data-index="3" placeholder="ä¸­é ­ç">
                <input type="text" class="goal-input" data-index="5" placeholder="é‡åˆ°å¶åƒ">
                <input type="text" class="goal-input" data-index="9" placeholder="æŠ½ä¸­é–€ç¥¨">
                <input type="text" class="goal-input" data-index="15" placeholder="å¤©æ°£æ™´æœ—">
                <input type="text" class="goal-input" data-index="19" placeholder="èº«é«”å¥åº·">
                <input type="text" class="goal-input" data-index="21" placeholder="äº¤é€šé †æš¢">
                <input type="text" class="goal-input" data-index="23" placeholder="è¬äº‹å¦‚æ„">
            </div>
        </div>
        <div class="clear-btn-container">
            <button onclick="clearAllGoals()">æ¸…é™¤æ‰€æœ‰ç›®æ¨™ä¸¦é‡æ´—ä½ç½®</button> 
        </div>
    </div>

    <p class="description">é»æ“Šè³“æœç›¤æ¨™è¨˜é”æˆï¼</p>
    
    <div id="bingo-board" class="bingo-grid"></div>
              
    <div style="display: flex; gap: 10px;">
        <button onclick="exportImage()" style="background: #e67e22;">ğŸ–¼ï¸ åŒ¯å‡ºåœ–ç‰‡ä¸‹è¼‰</button> 
    </div>
    
    <footer>
        <div class="footer-content">
            <span>Made with âœ¨ inspired by </span>
            <a href="https://note.com/keitauehara/n/ne86ee870f37c">ã†ãˆã¯ã‚‰ã‘ã„ãŸ</a>
        </div>
    </footer>  

    <canvas id="export-canvas" style="display:none;"></canvas>
   
    <script>
        const boardElement = document.getElementById('bingo-board');
        let goals = Array(25).fill("-----");
        let completed = Array(25).fill(false);
        let wonLines = [];
        // ä½ç½®æ˜ å°„è¡¨ï¼šå„²å­˜ã€Œè³‡æ–™ç´¢å¼•ã€å°æ‡‰åˆ°ã€Œè³“æœç›¤å“ªå€‹æ ¼å­ã€
        let displayMapping = Array.from({length: 25}, (_, i) => i);

        function getPrefix(index) {
            const idx = parseInt(index);
            if (idx === 12) return "ğŸŒŸ ";
            if ([6, 8, 16, 18].includes(idx)) return "ğŸ¯ ";
            if ([7, 11, 13, 17].includes(idx)) return "ğŸ“… ";
            if ([0, 2, 4, 10, 14, 20, 22, 24].includes(idx)) return "ğŸš¶ ";
            if ([1, 3, 5, 9, 15, 19, 21, 23].includes(idx)) return "ğŸ€ ";
            return "";
        }

        // æ´—ç‰Œå‡½æ•¸ï¼šé‡å°é€±æœ«ä»»å‹™èˆ‡é¡˜æœ›ä½éš¨æ©Ÿåˆ†é…ä½ç½®
        function shuffleDisplay() {
            const weekendIndices = [0, 2, 4, 10, 14, 20, 22, 24];
            const luckIndices = [1, 3, 5, 9, 15, 19, 21, 23];
            
            const shuffle = (array) => {
                const arr = [...array];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            };

            const shuffledWeekend = shuffle(weekendIndices);
            const shuffledLuck = shuffle(luckIndices);

            weekendIndices.forEach((orig, i) => displayMapping[orig] = shuffledWeekend[i]);
            luckIndices.forEach((orig, i) => displayMapping[orig] = shuffledLuck[i]);
        }

        function createBoard() {
            boardElement.innerHTML = '';
            // åå‘æŸ¥æ‰¾ï¼šç•«é¢ä¸Šç¬¬ i æ ¼ï¼Œè¦é¡¯ç¤ºå“ªä»½è³‡æ–™ï¼Ÿ
            const renderMap = [];
            displayMapping.forEach((targetPos, originalIdx) => {
                renderMap[targetPos] = originalIdx;
            });

            for (let i = 0; i < 25; i++) {
                const dataIdx = renderMap[i];
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                if (dataIdx === 12) cell.classList.add('type-core');
                if ([6, 8, 16, 18].includes(dataIdx)) cell.classList.add('type-main');
                if (completed[dataIdx]) cell.classList.add('completed');
                
                cell.textContent = goals[dataIdx];
                cell.onclick = () => toggleCell(dataIdx);
                boardElement.appendChild(cell);
            }
        }

        function toggleCell(dataIdx) {
            completed[dataIdx] = !completed[dataIdx];
            createBoard();
            checkBingo();
            saveToLocal();
        }

        function initInputs() {
            const allInputs = document.querySelectorAll('.goal-input');
            allInputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = e.target.getAttribute('data-index');
                    const prefix = getPrefix(index);
                    const val = e.target.value.trim();
                    goals[index] = val ? prefix + val : "-----";
                    createBoard(); 
                    saveToLocal();
                });
            });
        }

        const BINGO_LINES = [
            [0, 1, 2, 3, 4], [5, 6, 7, 8, 9], [10, 11, 12, 13, 14], [15, 16, 17, 18, 19], [20, 21, 22, 23, 24],
            [0, 5, 10, 15, 20], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18, 23], [4, 9, 14, 19, 24],
            [0, 6, 12, 18, 24], [4, 8, 12, 16, 20]
        ];

        function checkBingo() {
            let currentBingoLines = [];
            BINGO_LINES.forEach((line, index) => {
                // æ³¨æ„ï¼šé€£ç·šåˆ¤å®šå¿…é ˆåŸºæ–¼ã€Œç•«é¢ä½ç½®ã€
                const isBingo = line.every(pos => {
                    const dataIdx = displayMapping.indexOf(pos);
                    return completed[dataIdx] === true;
                });
                if (isBingo) currentBingoLines.push(index);
            });

            if (currentBingoLines.some(lineIdx => !wonLines.includes(lineIdx))) {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
            wonLines = currentBingoLines;
        }

        function saveToLocal() {
            const data = { goals, completed, wonLines, displayMapping };
            localStorage.setItem('lifeBingo2026_random', JSON.stringify(data));
        }

        function loadFromLocal() {
            const savedData = localStorage.getItem('lifeBingo2026_random');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                goals = parsedData.goals;
                completed = parsedData.completed;
                wonLines = parsedData.wonLines || [];
                displayMapping = parsedData.displayMapping || Array.from({length: 25}, (_, i) => i);
                
                const allInputs = document.querySelectorAll('.goal-input');
                allInputs.forEach(input => {
                    const index = input.getAttribute('data-index');
                    const prefix = getPrefix(index);
                    if (goals[index] !== "-----") {
                        input.value = goals[index].replace(prefix, "");
                    }
                });
                return true;
            }
            return false;
        }

        async function exportImage() {
            const canvas = document.getElementById('export-canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.src = 'https://assets.st-note.com/img/1768283868-8eNZaTYCc34DPEibXxs96fuz.png?width=1200';

            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                const fontSize = Math.floor(canvas.width / 35); 
                ctx.font = `bold ${fontSize}px "PingFang TC", "Microsoft JhengHei"`;

                const startX = canvas.width * 0.040;   
                const startY = canvas.height * 0.212;  
                const spacingX = canvas.width * 0.185; 
                const spacingY = canvas.height * 0.133; 

                for (let dataIdx = 0; dataIdx < 25; dataIdx++) {
                    const renderPos = displayMapping[dataIdx];
                    const row = Math.floor(renderPos / 5);
                    const col = renderPos % 5;
                    const x = startX + (col * spacingX) + (spacingX / 2);
                    const y = startY + (row * spacingY) + (spacingY / 2);

                    let displayText = goals[dataIdx] === "-----" ? "" : goals[dataIdx];
                    if (displayText) {
                        ctx.fillStyle = completed[dataIdx] ? "#d35400" : "#444";
                        wrapText(ctx, displayText, x, y, spacingX * 0.88, fontSize * 1.1);
                        if (completed[dataIdx]) {
                            ctx.save();
                            ctx.globalAlpha = 0.2;
                            ctx.fillStyle = "#f39c12";
                            ctx.font = `bold ${fontSize * 4}px serif`;
                            ctx.fillText("âœ“", x, y);
                            ctx.restore();
                        }
                    }
                }
                const link = document.createElement('a');
                link.download = '2026_Life_Bingo_Random.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            };
        }

        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const words = text.split(""); 
            let line = "";
            let lines = [];
            for (let n = 0; n < words.length; n++) {
                let testLine = line + words[n];
                if (context.measureText(testLine).width > maxWidth && n > 0) {
                    lines.push(line);
                    line = words[n];
                } else {
                    line = testLine;
                }
            }
            lines.push(line);
            let sy = y - ((lines.length - 1) * lineHeight) / 2;
            lines.forEach((l, k) => context.fillText(l, x, sy + (k * lineHeight)));
        }

        function clearAllGoals() {
            if (!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç›®æ¨™ä¸¦é‡æ–°æ´—ç‰Œä½ç½®å—ï¼Ÿ")) return;
            goals.fill("-----");
            completed.fill(false);
            wonLines = [];
            document.querySelectorAll('.goal-input').forEach(i => i.value = "");
            shuffleDisplay(); // åªæœ‰åœ¨æ¸…é™¤æ™‚é‡æ–°æ´—ç‰Œ
            createBoard();
            saveToLocal();
            alert("å·²å…¨éƒ¨é‡è¨­ï¼");
        }

        window.onload = () => {
           const hasData = loadFromLocal();
           if (!hasData) shuffleDisplay();
           initInputs();
           createBoard();
        };
    </script>
</body>
</html>
