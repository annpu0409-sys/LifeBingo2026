<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <title>2026 äººç”Ÿç›®æ¨™è³“æœ</title>
    <style>
        :root {
            --primary-color: #f39c12;
            --bg-color: #f9f9f9;
            --cell-size: 70px;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 { color: #333; margin-bottom: 10px; }
        .description { font-size: 0.9rem; color: #666; margin-bottom: 20px; text-align: center; }

        /* è³“æœç›¤å®¹å™¨ */
        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 500px;
            width: 100%;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* æ–¹æ ¼æ¨£å¼ */
        .cell {
            aspect-ratio: 1 / 1;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            text-align: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .cell:hover { border-color: var(--primary-color); background: #fffef0; }

        /* å·²å®Œæˆçš„æ¨£å¼ */
        .cell.completed {
            background-color: #ffeaa7;
            border-color: var(--primary-color);
            color: #d35400;
            font-weight: bold;
        }

        .cell.completed::after {
            content: "âœ“";
            position: absolute;
            font-size: 2rem;
            color: rgba(243, 156, 18, 0.3);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* ä¸åŒå€åŸŸçš„æç¤ºè‰²ï¼ˆé–‹ç™¼è¼”åŠ©ç”¨ï¼‰ */
        .type-core { border-style: double; border-width: 4px; } /* æ ¸å¿ƒ */
        .type-main { background-color: #f0f7ff; } /* èªçœŸç›®æ¨™ */

        button {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; color: #444; }
        .input-group input { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            box-sizing: border-box;
            margin-bottom: 5px;
        }
        #inputs-main { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .grid-inputs-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .goal-input { 
              width: 100%; 
              padding: 8px; 
              border: 1px solid #ddd; 
              border-radius: 4px; 
              font-size: 0.85rem;
        }
        .goal-input:focus { border-color: var(--primary-color); outline: none; background: #fffdf0; }
        
        .cell.completed {
              background-color: #ffeaa7;
              border-color: var(--primary-color);
              color: #d35400;
              font-weight: bold;
              animation: pop 0.3s ease-out; /* åŠ å…¥ä¸€å€‹å½ˆè·³å°å‹•ç•« */
          }
          
          @keyframes pop {
              0% { transform: scale(1); }
              50% { transform: scale(1.1); }
              100% { transform: scale(1); }
          }
        
    </style>
</head>
<body>

    <h1>2026 äººç”Ÿç›®æ¨™è³“æœ</h1>
  
    <div id="setup-wizard" style="max-width: 500px; width: 100%; background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
    <h3>Step 1: å¡«å¯«ä½ çš„ 2026 ç›®æ¨™</h3>
    
    <div class="input-group">
        <label>ğŸŒŸ æ ¸å¿ƒï¼šä»Šå¹´çµ•å°èƒ½é”æˆçš„ä¸€ä»¶äº‹</label>
        <input type="text" class="goal-input" data-index="12" placeholder="ä¾‹å¦‚ï¼šæ¯å¤©å–æ°´ 2000cc">
    </div>

    <div class="input-group">
        <label>ğŸ¯ æ ¸å¿ƒç›®æ¨™ï¼šæ¯”è¼ƒèªçœŸçš„æŒ‘æˆ° (å››å€‹è§’è½)</label>
        <div class="grid-inputs">
            <input type="text" class="goal-input" data-index="0" placeholder="ç›®æ¨™ 1">
            <input type="text" class="goal-input" data-index="4" placeholder="ç›®æ¨™ 2">
            <input type="text" class="goal-input" data-index="20" placeholder="ç›®æ¨™ 3">
            <input type="text" class="goal-input" data-index="24" placeholder="ç›®æ¨™ 4">
        </div>
    </div>

    <div class="input-group">
        <label>ğŸ“… å¹´åº¦äº‹ä»¶ï¼šèˆ‡ç‰¹å®šæ™‚ç¯€ç›¸é—œ (ä¸­å¤®ä¸Šä¸‹å·¦å³)</label>
        <div class="grid-inputs">
            <input type="text" class="goal-input" data-index="7" placeholder="ä¾‹å¦‚ï¼šçœ‹å¤å­£ç…™ç«">
            <input type="text" class="goal-input" data-index="11" placeholder="ä¾‹å¦‚ï¼šè³æ«»èŠ±">
            <input type="text" class="goal-input" data-index="13" placeholder="ä¾‹å¦‚ï¼šè·¨å¹´æ—…è¡Œ">
            <input type="text" class="goal-input" data-index="17" placeholder="ä¾‹å¦‚ï¼šé€±å¹´ç´€å¿µ">
        </div>
    </div>

    <div class="input-group">
        <label>ğŸš¶ é€±æœ«ä»»å‹™ï¼šå…©å¤©å…§å¯æå®š (å¤–é‚Šä¸­æ®µ)</label>
        <div class="grid-inputs-4">
            <input type="text" class="goal-input" data-index="1" placeholder="æ•´ç†æˆ¿é–“">
            <input type="text" class="goal-input" data-index="2" placeholder="è®€å®Œä¸€æœ¬æ›¸">
            <input type="text" class="goal-input" data-index="3" placeholder="è²·æ–°å®¶é›»">
            <input type="text" class="goal-input" data-index="5" placeholder="çœ‹å ´é›»å½±">
            <input type="text" class="goal-input" data-index="9" placeholder="æ›æ–°é«®å‹">
            <input type="text" class="goal-input" data-index="15" placeholder="åƒæ–°é¤å»³">
            <input type="text" class="goal-input" data-index="19" placeholder="æ–·æ¨é›¢">
            <input type="text" class="goal-input" data-index="21" placeholder="é€›åšç‰©é¤¨">
        </div>
    </div>

    <div class="input-group">
        <label>ğŸ€ é¡˜æœ›ä½ï¼šåå‘é‹æ°£æˆ–å¤§é¡˜æœ› (å‰©é¤˜ç©ºæ ¼)</label>
        <div class="grid-inputs-4">
            <input type="text" class="goal-input" data-index="6" placeholder="ç™¼ç¥¨ä¸­ç">
            <input type="text" class="goal-input" data-index="8" placeholder="ä¸­é ­ç">
            <input type="text" class="goal-input" data-index="10" placeholder="é‡åˆ°å¶åƒ">
            <input type="text" class="goal-input" data-index="14" placeholder="æŠ½ä¸­é–€ç¥¨">
            <input type="text" class="goal-input" data-index="16" placeholder="å¤©æ°£æ™´æœ—">
            <input type="text" class="goal-input" data-index="18" placeholder="èº«é«”å¥åº·">
            <input type="text" class="goal-input" data-index="22" placeholder="äº¤é€šé †æš¢">
            <input type="text" class="goal-input" data-index="23" placeholder="è¬äº‹å¦‚æ„">
        </div>
    </div>
    </div>
      <p class="description">é»æ“Šä¸‹æ–¹æ–¹æ ¼æ¨™è¨˜é”æˆï¼Œå†æ¬¡é»æ“Šå–æ¶ˆã€‚</p>
      
          <div id="bingo-board" class="bingo-grid"></div>
              
    <div style="display: flex; gap: 10px;">
        <button onclick="saveProgress()">ğŸ’¾ å„²å­˜é€²åº¦</button>
        <button onclick="exportImage()" style="background: #e67e22;">ğŸ–¼ï¸ åŒ¯å‡ºåœ–ç‰‡ä¸‹è¼‰</button>
    </div>
    
    <canvas id="export-canvas" style="display:none;"></canvas>
   
    <script>
            const boardElement = document.getElementById('bingo-board');
            let goals = Array(25).fill("-----");
            // æ–°å¢ï¼šç´€éŒ„æ¯å€‹æ ¼å­çš„å®Œæˆç‹€æ…‹ (false ç‚ºæœªå®Œæˆï¼Œtrue ç‚ºå·²å®Œæˆ)
            let completed = Array(25).fill(false);
            
            function getPrefix(index) {
                const idx = parseInt(index);
                if (idx === 12) return "ğŸŒŸ ";
                if ([0, 4, 20, 24].includes(idx)) return "ğŸ¯ ";
                if ([7, 11, 13, 17].includes(idx)) return "ğŸ“… ";
                if ([1, 2, 3, 5, 9, 15, 19, 21].includes(idx)) return "ğŸš¶ ";
                if ([6, 8, 10, 14, 16, 18, 22, 23].includes(idx)) return "ğŸ€ ";
                return "";
            }
            
            function initInputs() {
                const allInputs = document.querySelectorAll('.goal-input');
                allInputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        const index = e.target.getAttribute('data-index');
                        const prefix = getPrefix(index);
                        const val = e.target.value.trim();
                        goals[index] = val ? prefix + val : "-----";
                        createBoard(); // é‡æ–°ç¹ªè£½æ™‚æœƒåƒè€ƒ completed é™£åˆ—
                    });
                });
            }
            
            function createBoard() {
                boardElement.innerHTML = '';
                for (let i = 0; i < 25; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    if (i === 12) cell.classList.add('type-core');
                    if ([0, 4, 20, 24].includes(i)) cell.classList.add('type-main');
            
                    // ä¿®æ”¹é»ï¼šç¹ªè£½æ™‚æª¢æŸ¥è©²ç´¢å¼•æ˜¯å¦å·²å®Œæˆ
                    if (completed[i]) {
                        cell.classList.add('completed');
                    }
            
                    cell.textContent = goals[i];
                    // ä¿®æ”¹é»ï¼šé»æ“Šæ™‚å‚³å…¥ç´¢å¼• i
                    cell.onclick = () => toggleCell(i);
                    boardElement.appendChild(cell);
                }
            }
            
            function toggleCell(index) {
                // åˆ‡æ›è©²ç´¢å¼•çš„ç‹€æ…‹
                completed[index] = !completed[index];
                createBoard(); // é‡æ–°æ¸²æŸ“ç•«é¢
                checkBingo();
            }
            
            const BINGO_LINES = [
                [0, 1, 2, 3, 4], [5, 6, 7, 8, 9], [10, 11, 12, 13, 14], [15, 16, 17, 18, 19], [20, 21, 22, 23, 24],
                [0, 5, 10, 15, 20], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18, 23], [4, 9, 14, 19, 24],
                [0, 6, 12, 18, 24], [4, 8, 12, 16, 20]
            ];
            
            let wonLines = [];
            
            function checkBingo() {
                let currentBingoLines = []; // æœ¬æ¬¡æª¢æŸ¥ä¸­æ‰€æœ‰é”æˆçš„é€£ç·š

                BINGO_LINES.forEach((line, index) => {
                    // æª¢æŸ¥è©²ç·šæ®µä¸­çš„æ¯ä¸€æ ¼æ˜¯å¦éƒ½åŒ…å«å·²å®Œæˆ
                    const isBingo = line.every(cellIdx => completed[cellIdx] === true);
                    
                    if (isBingo) {
                        currentBingoLines.push(index); // ç´€éŒ„é€™æ¢ç·šçš„ç·¨è™Ÿ
                    }
                });
            
                // é—œéµé‚è¼¯ï¼šæ‰¾å‡ºã€Œæ–°é”æˆã€çš„é€£ç·š (ç›®å‰çš„é€£ç·šä¸åœ¨ä¹‹å‰çš„ wonLines ç´€éŒ„ä¸­)
                const newBingoFound = currentBingoLines.some(lineIdx => !wonLines.includes(lineIdx));
            
                if (newBingoFound) {
                    triggerCelebration();
                }
            
                // æ›´æ–° wonLines ç´€éŒ„ï¼Œç¢ºä¿ä¸‹æ¬¡é»æ“Šæ™‚çŸ¥é“å“ªäº›å·²ç¶“å™´éäº†
                // é€™æ¨£å°±ç®—å–æ¶ˆå‹¾é¸ï¼ŒwonLines ä¹ŸæœƒåŒæ­¥æ›´æ–°
                wonLines = currentBingoLines;
            }
            
            function triggerCelebration() {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#f39c12', '#e74c3c', '#3498db', '#2ecc71']
                });
            }
            
            function saveProgress() {
                saveToLocal();
                alert("ğŸ’¾ é€²åº¦å„²å­˜æˆåŠŸï¼");
            }
            
            // å„²å­˜è³‡æ–™åˆ°ç€è¦½å™¨
            function saveToLocal() {
                const data = {
                    goals: goals,
                    completed: completed,
                    wonLines: wonLines
                };
                localStorage.setItem('lifeBingo2026', JSON.stringify(data));
                console.log("é€²åº¦å·²è‡ªå‹•å„²å­˜");
            }
            
            // å¾ç€è¦½å™¨è®€å–è³‡æ–™
            function loadFromLocal() {
                const savedData = localStorage.getItem('lifeBingo2026');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    goals = parsedData.goals;
                    completed = parsedData.completed;
                    wonLines = parsedData.wonLines || [];
                    
                    // åŒæ­¥æ›´æ–°è¼¸å…¥æ¡†çš„æ–‡å­—å…§å®¹
                    const allInputs = document.querySelectorAll('.goal-input');
                    allInputs.forEach(input => {
                        const index = input.getAttribute('data-index');
                        // å»æ‰å‰ç¶´ç¬¦è™Ÿä»¥ä¾¿ä½¿ç”¨è€…ä¿®æ”¹
                        const prefix = getPrefix(index);
                        if (goals[index] !== "-----") {
                            input.value = goals[index].replace(prefix, "");
                        }
                    });
                    return true;
                }
                return false;
            }
            
            function initInputs() {
                const allInputs = document.querySelectorAll('.goal-input');
                allInputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        const index = e.target.getAttribute('data-index');
                        const prefix = getPrefix(index);
                        const val = e.target.value.trim();
                        goals[index] = val ? prefix + val : "-----";
                        createBoard(); 
                        saveToLocal(); // <-- æ–°å¢ï¼šæ‰“å­—æ™‚è‡ªå‹•å„²å­˜
                    });
                });
            }
            
            function toggleCell(index) {
                completed[index] = !completed[index];
                createBoard();
                checkBingo();
                saveToLocal(); // <-- æ–°å¢ï¼šè“‹ç« æ™‚è‡ªå‹•å„²å­˜
            }
            
            
            async function exportImage() {
                const canvas = document.getElementById('export-canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                // å…è¨±è·¨åŸŸè®€å–åœ–ç‰‡
                img.crossOrigin = "anonymous";
                img.src = 'https://assets.st-note.com/img/1768283868-8eNZaTYCc34DPEibXxs96fuz.png?width=1200';
            
                console.log("æ­£åœ¨æº–å‚™åŒ¯å‡ºåœ–ç‰‡...");
            
                img.onload = function() {
                    console.log("åº•åœ–è¼‰å…¥æˆåŠŸï¼Œé–‹å§‹ç¹ªè£½...");
                    canvas.width = img.width;
                    canvas.height = img.height;
            
                    // ç¹ªè£½åº•åœ–
                    ctx.drawImage(img, 0, 0);
            
                    // æ–‡å­—æ¨£å¼è¨­å®š
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    
                    // æ ¹æ“š 1200 å¯¬åº¦è¨­å®šé©ç•¶å­—é«”å¤§å°
                    const fontSize = Math.floor(canvas.width / 35); 
                    ctx.font = `bold ${fontSize}px "PingFang TC", "Microsoft JhengHei"`;
            
                    // --- ç²¾ç¢ºåº§æ¨™ä¿®æ­£å€ ---
                    const startX = canvas.width * 0.040;   
                    const startY = canvas.height * 0.212;  
                    const spacingX = canvas.width * 0.185; 
                    const spacingY = canvas.height * 0.133; 
            
                    for (let i = 0; i < 25; i++) {
                        const row = Math.floor(i / 5);
                        const col = i % 5;
                        const x = startX + (col * spacingX) + (spacingX / 2);
                        const y = startY + (row * spacingY) + (spacingY / 2);
            
                        // å–å¾—å®Œæ•´æ–‡å­—ï¼ˆåŒ…å« ğŸŒŸ ğŸ¯ ç­‰ç¬¦è™Ÿï¼‰
                        let displayText = goals[i] === "-----" ? "" : goals[i];
            
                        if (displayText) {
                            // è¨­å®šé¡è‰²ï¼šå·²å®Œæˆç”¨æ©˜ç´…ï¼Œæœªå®Œæˆç”¨æ·±ç°
                            ctx.fillStyle = completed[i] ? "#d35400" : "#444";
                            
                            // å‘¼å«æ›è¡Œå‡½æ•¸ç¹ªè£½æ–‡å­— (å‚³å…¥æ­£ç¢ºçš„è®Šæ•¸ displayText)
                             wrapText(ctx, displayText, x, y, spacingX * 0.88, fontSize * 1.1);
                            
                            // [å¯é¸] å¦‚æœå·²å®Œæˆï¼Œåœ¨æ–‡å­—ä¸‹æ–¹åŠ ä¸€å€‹å°åœ“é»æˆ–è¨˜è™Ÿ
                            if (completed[i]) {
                                ctx.save();
                                ctx.globalAlpha = 0.3; // é€æ˜åº¦
                                ctx.fillStyle = "#f39c12";
                                ctx.font = `bold ${fontSize * 4}px serif`;
                                ctx.fillText("âœ“", x, y);
                                ctx.restore();
                            }
                        }
                    }
            
                    // ä¸‹è¼‰åœ–ç‰‡
                    try {
                        const dataUrl = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = '2026_My_Life_Bingo.png';
                        link.href = dataUrl;
                        link.click();
                        console.log("ä¸‹è¼‰æˆåŠŸï¼");
                    } catch (err) {
                        console.error("ä¸‹è¼‰å¤±æ•—:", err);
                        alert("åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¢ºä¿æ‚¨æ˜¯åœ¨ä¼ºæœå™¨ç’°å¢ƒï¼ˆå¦‚ Live Serverï¼‰ä¸‹åŸ·è¡Œï¼Œæˆ–å˜—è©¦æ›´æ›ç€è¦½å™¨ã€‚");
                    }
                };
            
                img.onerror = function() {
                    alert("åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
                };
            }
            // è¼”åŠ©å‡½æ•¸ï¼šè™•ç† Canvas æ–‡å­—æ›è¡Œ
            function wrapText(context, text, x, y, maxWidth, lineHeight) {
                const words = text.split(""); 
                let line = "";
                let lines = [];
            
                for (let n = 0; n < words.length; n++) {
                    let testLine = line + words[n];
                    let metrics = context.measureText(testLine);
                    if (metrics.width > maxWidth && n > 0) {
                        lines.push(line);
                        line = words[n];
                    } else {
                        line = testLine;
                    }
                }
                lines.push(line);
            
                // è¨ˆç®—èµ·å§‹é«˜åº¦è®“æ–‡å­—å±…ä¸­
                let startY = y - ((lines.length - 1) * lineHeight) / 2;
                for (let k = 0; k < lines.length; k++) {
                    context.fillText(lines[k], x, startY + (k * lineHeight));
                }
            }
            
            
            window.onload = () => {
               const hasData = loadFromLocal(); // <-- å…ˆè®€å–è³‡æ–™
                initInputs();
                createBoard();
                if (hasData) console.log("æ­¡è¿å›ä¾†ï¼å·²è¼‰å…¥ä¸Šæ¬¡é€²åº¦ã€‚");
             };
             
    </script>
</body>
</html>